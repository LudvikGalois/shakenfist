#########################################
# Scenario: verify networking on our cirros instances
#########################################

- hosts: hypervisors
  any_errors_fatal: true
  become: yes
  become_method: sudo
  gather_facts: no
  connection: ssh

  tasks:
    - include: _util_network_cirros_validate.yml
        console_port="{{cirros_console_port}}"
        uuid="{{cirros_uuid}}"
        netblock_octets="192.168.242"

- hosts: sf-1
  any_errors_fatal: true
  become: yes
  become_method: sudo
  gather_facts: no
  connection: ssh

  tasks:
    - name: The instance on sf-1 should be able to ping the instance on sf-2
      shell: |
        [ `/opt/telnet_client.py {{cirros_console_port}} ping {{hostvars['sf-2']['cirros_ip']}} | grep -c " 0% packet loss"` -eq 1 ]
